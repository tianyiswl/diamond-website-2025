<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡µé¢çŠ¶æ€æŒä¹…åŒ–æµ‹è¯•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="mb-4">ğŸ§ª é¡µé¢çŠ¶æ€æŒä¹…åŒ–åŠŸèƒ½æµ‹è¯•</h1>
        <p class="text-muted mb-4">æµ‹è¯•åå°ç®¡ç†ç³»ç»Ÿçš„é¡µé¢çŠ¶æ€ä¿å­˜å’Œæ¢å¤åŠŸèƒ½</p>

        <!-- å½“å‰çŠ¶æ€æ˜¾ç¤º -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">ğŸ“Š å½“å‰çŠ¶æ€</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <strong>ä¿å­˜çš„é¡µé¢:</strong>
                        <div class="code-block" id="saved-page">æ£€æµ‹ä¸­...</div>
                    </div>
                    <div class="col-md-6">
                        <strong>localStorage æ”¯æŒ:</strong>
                        <div class="code-block" id="storage-support">æ£€æµ‹ä¸­...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åŠŸèƒ½æµ‹è¯• -->
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">ğŸ”§ åŠŸèƒ½æµ‹è¯•</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <button class="btn btn-primary w-100" onclick="testSavePage('products')">
                            ä¿å­˜äº§å“ç®¡ç†é¡µé¢
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-info w-100" onclick="testSavePage('add-product')">
                            ä¿å­˜æ·»åŠ äº§å“é¡µé¢
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-warning w-100" onclick="testSavePage('inquiries')">
                            ä¿å­˜è¯¢ä»·ç®¡ç†é¡µé¢
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-secondary w-100" onclick="testGetPage()">
                            è·å–ä¿å­˜çš„é¡µé¢
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-danger w-100" onclick="testClearPage()">
                            æ¸…é™¤é¡µé¢çŠ¶æ€
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-success w-100" onclick="location.reload()">
                            åˆ·æ–°é¡µé¢æµ‹è¯•
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•ç»“æœ -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">ğŸ“‹ æµ‹è¯•ç»“æœ</h5>
            </div>
            <div class="card-body">
                <div id="test-results">
                    <p class="text-muted">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
                </div>
            </div>
        </div>

        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">ğŸ“– ä½¿ç”¨è¯´æ˜</h5>
            </div>
            <div class="card-body">
                <ol>
                    <li><strong>ä¿å­˜é¡µé¢çŠ¶æ€</strong>: ç‚¹å‡»"ä¿å­˜XXXé¡µé¢"æŒ‰é’®æ¨¡æ‹Ÿé¡µé¢åˆ‡æ¢</li>
                    <li><strong>æŸ¥çœ‹ä¿å­˜çŠ¶æ€</strong>: ç‚¹å‡»"è·å–ä¿å­˜çš„é¡µé¢"æŸ¥çœ‹å½“å‰ä¿å­˜çš„é¡µé¢</li>
                    <li><strong>æµ‹è¯•é¡µé¢æ¢å¤</strong>: ä¿å­˜é¡µé¢åç‚¹å‡»"åˆ·æ–°é¡µé¢æµ‹è¯•"ï¼Œé¡µé¢åº”è¯¥è®°ä½çŠ¶æ€</li>
                    <li><strong>æ¸…é™¤çŠ¶æ€</strong>: ç‚¹å‡»"æ¸…é™¤é¡µé¢çŠ¶æ€"é‡ç½®åˆ°é»˜è®¤çŠ¶æ€</li>
                </ol>
                <div class="alert alert-info mt-3">
                    <strong>ğŸ’¡ æç¤º</strong>: å¦‚æœåŠŸèƒ½æ­£å¸¸ï¼Œåˆ·æ–°é¡µé¢ååº”è¯¥çœ‹åˆ°ä¹‹å‰ä¿å­˜çš„é¡µé¢çŠ¶æ€ã€‚
                </div>
            </div>
        </div>
    </div>

    <script>
        // å¤åˆ¶åå°çš„é¡µé¢çŠ¶æ€ç®¡ç†å‡½æ•°
        function saveLastVisitedPage(page) {
            try {
                localStorage.setItem('lastVisitedPage', page);
                return true;
            } catch (error) {
                console.warn('ä¿å­˜é¡µé¢çŠ¶æ€å¤±è´¥:', error);
                return false;
            }
        }

        function getLastVisitedPage() {
            try {
                const lastPage = localStorage.getItem('lastVisitedPage');
                const validPages = ['dashboard', 'products', 'add-product', 'inquiries', 'admin-management'];
                if (lastPage && validPages.includes(lastPage)) {
                    return lastPage;
                }
            } catch (error) {
                console.warn('è·å–é¡µé¢çŠ¶æ€å¤±è´¥:', error);
            }
            return 'dashboard';
        }

        function clearLastVisitedPage() {
            try {
                localStorage.removeItem('lastVisitedPage');
                return true;
            } catch (error) {
                console.warn('æ¸…é™¤é¡µé¢çŠ¶æ€å¤±è´¥:', error);
                return false;
            }
        }

        // æµ‹è¯•å‡½æ•°
        function testSavePage(page) {
            const success = saveLastVisitedPage(page);
            const pageNames = {
                'dashboard': 'æ§åˆ¶å°',
                'products': 'äº§å“ç®¡ç†',
                'add-product': 'æ·»åŠ äº§å“',
                'inquiries': 'è¯¢ä»·ç®¡ç†',
                'admin-management': 'ç®¡ç†å‘˜ç®¡ç†'
            };
            
            addTestResult(
                success ? 'success' : 'error',
                `ä¿å­˜é¡µé¢çŠ¶æ€: ${pageNames[page]}`,
                success ? 'âœ… ä¿å­˜æˆåŠŸ' : 'âŒ ä¿å­˜å¤±è´¥'
            );
            
            updateCurrentStatus();
        }

        function testGetPage() {
            const savedPage = getLastVisitedPage();
            const pageNames = {
                'dashboard': 'æ§åˆ¶å°',
                'products': 'äº§å“ç®¡ç†',
                'add-product': 'æ·»åŠ äº§å“',
                'inquiries': 'è¯¢ä»·ç®¡ç†',
                'admin-management': 'ç®¡ç†å‘˜ç®¡ç†'
            };
            
            addTestResult(
                'info',
                'è·å–ä¿å­˜çš„é¡µé¢',
                `ğŸ“„ å½“å‰ä¿å­˜çš„é¡µé¢: ${pageNames[savedPage]} (${savedPage})`
            );
        }

        function testClearPage() {
            const success = clearLastVisitedPage();
            addTestResult(
                success ? 'success' : 'error',
                'æ¸…é™¤é¡µé¢çŠ¶æ€',
                success ? 'ğŸ—‘ï¸ æ¸…é™¤æˆåŠŸ' : 'âŒ æ¸…é™¤å¤±è´¥'
            );
            
            updateCurrentStatus();
        }

        function addTestResult(type, title, message) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = `
                <strong>${title}</strong><br>
                ${message}<br>
                <small>æ—¶é—´: ${new Date().toLocaleTimeString()}</small>
            `;
            resultsDiv.appendChild(resultDiv);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function updateCurrentStatus() {
            // æ›´æ–°ä¿å­˜çš„é¡µé¢æ˜¾ç¤º
            const savedPage = localStorage.getItem('lastVisitedPage') || 'æ— ';
            document.getElementById('saved-page').textContent = savedPage;
            
            // æ£€æŸ¥ localStorage æ”¯æŒ
            let storageSupport = 'âŒ ä¸æ”¯æŒ';
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                storageSupport = 'âœ… æ”¯æŒ';
            } catch (e) {
                storageSupport = 'âŒ ä¸æ”¯æŒ (å¯èƒ½æ˜¯éšç§æ¨¡å¼)';
            }
            document.getElementById('storage-support').textContent = storageSupport;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentStatus();
            
            // å¦‚æœæœ‰ä¿å­˜çš„é¡µé¢çŠ¶æ€ï¼Œæ˜¾ç¤ºæ¢å¤ä¿¡æ¯
            const savedPage = localStorage.getItem('lastVisitedPage');
            if (savedPage && savedPage !== 'dashboard') {
                const pageNames = {
                    'products': 'äº§å“ç®¡ç†',
                    'add-product': 'æ·»åŠ äº§å“',
                    'inquiries': 'è¯¢ä»·ç®¡ç†',
                    'admin-management': 'ç®¡ç†å‘˜ç®¡ç†'
                };
                
                addTestResult(
                    'info',
                    'é¡µé¢çŠ¶æ€æ¢å¤',
                    `ğŸ”„ æ£€æµ‹åˆ°ä¿å­˜çš„é¡µé¢çŠ¶æ€: ${pageNames[savedPage] || savedPage}`
                );
            }
        });
    </script>
</body>
</html>
