<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” é¡µé¢è·³è½¬è¯Šæ–­å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .warning { background: #fff3cd; color: #856404; }
        .danger { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .test-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #f9f9f9;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn.success { background: #28a745; }
        .btn.warning { background: #ffc107; color: #000; }
        .btn.danger { background: #dc3545; }
        .logs {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” é¡µé¢è·³è½¬è¯Šæ–­å·¥å…·</h1>
        <p>è¯Šæ–­é¡µé¢è·³è½¬å¼‚å¸¸å’Œ"DIAMOND"æ˜¾ç¤ºé—®é¢˜</p>
        
        <div class="section">
            <h3>ğŸ¯ é—®é¢˜æè¿°</h3>
            <div class="status warning">
                <strong>âš ï¸ æŠ¥å‘Šçš„é—®é¢˜ï¼š</strong>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>é¡µé¢è·³è½¬æ—¶æ˜¾ç¤ºå¼‚å¸¸å†…å®¹ï¼ˆ"DIAMOND"é¡µé¢ï¼‰</li>
                    <li>äº§å“é¡µé¢ä¸æ˜¾ç¤ºäº§å“å†…å®¹ï¼ˆæ˜¾ç¤º"å…±0ä¸ªäº§å“"ï¼‰</li>
                    <li>ç§»é™¤åŠ è½½åŠ¨ç”»åå‡ºç°åŠŸèƒ½å¤±æ•ˆ</li>
                </ul>
            </div>
        </div>
        
        <div class="section">
            <h3>ğŸ§ª å¯¼èˆªæµ‹è¯•</h3>
            <div class="test-grid">
                <div class="test-card">
                    <h4>ğŸ  ä¸»é¡µæµ‹è¯•</h4>
                    <p>æµ‹è¯•ä¸»é¡µæ˜¯å¦æ­£å¸¸æ˜¾ç¤º</p>
                    <a href="/" class="btn" target="_blank">æ‰“å¼€ä¸»é¡µ</a>
                    <button class="btn warning" onclick="testPage('/')">è¯Šæ–­ä¸»é¡µ</button>
                </div>
                
                <div class="test-card">
                    <h4>ğŸ“¦ äº§å“é¡µé¢</h4>
                    <p>æµ‹è¯•äº§å“é¡µé¢åŠŸèƒ½</p>
                    <a href="/pages/products.html" class="btn" target="_blank">æ‰“å¼€äº§å“é¡µ</a>
                    <button class="btn warning" onclick="testPage('/pages/products.html')">è¯Šæ–­äº§å“é¡µ</button>
                </div>
                
                <div class="test-card">
                    <h4>â„¹ï¸ å…³äºæˆ‘ä»¬</h4>
                    <p>æµ‹è¯•å…³äºé¡µé¢</p>
                    <a href="/pages/about.html" class="btn" target="_blank">æ‰“å¼€å…³äºé¡µ</a>
                    <button class="btn warning" onclick="testPage('/pages/about.html')">è¯Šæ–­å…³äºé¡µ</button>
                </div>
                
                <div class="test-card">
                    <h4>ğŸ“ è”ç³»æˆ‘ä»¬</h4>
                    <p>æµ‹è¯•è”ç³»é¡µé¢</p>
                    <a href="/pages/contact.html" class="btn" target="_blank">æ‰“å¼€è”ç³»é¡µ</a>
                    <button class="btn warning" onclick="testPage('/pages/contact.html')">è¯Šæ–­è”ç³»é¡µ</button>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h3>ğŸ”§ ä¿®å¤çŠ¶æ€æ£€æŸ¥</h3>
            <div id="fixStatus">
                <div class="status info">â³ æ­£åœ¨æ£€æŸ¥ä¿®å¤çŠ¶æ€...</div>
            </div>
            <button class="btn success" onclick="checkFixStatus()">é‡æ–°æ£€æŸ¥ä¿®å¤çŠ¶æ€</button>
        </div>
        
        <div class="section">
            <h3>ğŸ“Š è¯Šæ–­ç»“æœ</h3>
            <div id="diagnosticResults">
                <div class="status info">ç­‰å¾…è¯Šæ–­...</div>
            </div>
        </div>
        
        <div class="section">
            <h3>ğŸ“ è¯Šæ–­æ—¥å¿—</h3>
            <div id="logs" class="logs">è¯Šæ–­å·¥å…·å·²å¯åŠ¨...\n</div>
            <button class="btn" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
        </div>
    </div>

    <script>
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('logs');
            const prefix = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            logElement.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        // æµ‹è¯•é¡µé¢
        async function testPage(url) {
            log(`å¼€å§‹æµ‹è¯•é¡µé¢: ${url}`, 'info');
            
            try {
                const response = await fetch(url);
                log(`é¡µé¢å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const content = await response.text();
                    
                    // æ£€æŸ¥é¡µé¢å†…å®¹
                    const checks = [
                        { name: 'åŒ…å«DOCTYPE', test: content.includes('<!DOCTYPE') },
                        { name: 'åŒ…å«HTMLæ ‡ç­¾', test: content.includes('<html') },
                        { name: 'åŒ…å«HEADæ ‡ç­¾', test: content.includes('<head') },
                        { name: 'åŒ…å«BODYæ ‡ç­¾', test: content.includes('<body') },
                        { name: 'åŒ…å«æ ‡é¢˜', test: content.includes('<title') },
                        { name: 'åŒ…å«CSS', test: content.includes('<link') || content.includes('<style') },
                        { name: 'åŒ…å«JavaScript', test: content.includes('<script') },
                        { name: 'ä¸æ˜¯é”™è¯¯é¡µé¢', test: !content.toLowerCase().includes('error') && !content.toLowerCase().includes('not found') }
                    ];
                    
                    let passedChecks = 0;
                    checks.forEach(check => {
                        if (check.test) {
                            passedChecks++;
                            log(`  âœ… ${check.name}`, 'success');
                        } else {
                            log(`  âŒ ${check.name}`, 'error');
                        }
                    });
                    
                    // ç‰¹æ®Šæ£€æŸ¥ï¼šæ˜¯å¦åŒ…å«"DIAMOND"
                    if (content.includes('DIAMOND') && !content.includes('diamond-website')) {
                        log(`  âš ï¸ æ£€æµ‹åˆ°å¯ç–‘çš„DIAMONDå†…å®¹`, 'warning');
                    }
                    
                    // æ£€æŸ¥äº§å“é¡µé¢ç‰¹æœ‰å†…å®¹
                    if (url.includes('products.html')) {
                        const productChecks = [
                            { name: 'åŒ…å«äº§å“ç½‘æ ¼', test: content.includes('products-grid') || content.includes('productsGrid') },
                            { name: 'åŒ…å«äº§å“è®¡æ•°', test: content.includes('ä¸ªäº§å“') },
                            { name: 'åŒ…å«æœç´¢æ¡†', test: content.includes('searchInput') },
                            { name: 'åŒ…å«åˆ†ç±»ç­›é€‰', test: content.includes('categoryFilter') }
                        ];
                        
                        productChecks.forEach(check => {
                            if (check.test) {
                                log(`  âœ… äº§å“é¡µé¢: ${check.name}`, 'success');
                            } else {
                                log(`  âŒ äº§å“é¡µé¢: ${check.name}`, 'error');
                            }
                        });
                    }
                    
                    log(`é¡µé¢æ£€æŸ¥å®Œæˆ: ${passedChecks}/${checks.length} é¡¹é€šè¿‡`, passedChecks === checks.length ? 'success' : 'warning');
                    
                } else {
                    log(`é¡µé¢åŠ è½½å¤±è´¥: ${response.status}`, 'error');
                }
                
            } catch (error) {
                log(`é¡µé¢æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ£€æŸ¥ä¿®å¤çŠ¶æ€
        async function checkFixStatus() {
            log('å¼€å§‹æ£€æŸ¥ä¿®å¤çŠ¶æ€...', 'info');
            const statusElement = document.getElementById('fixStatus');
            
            try {
                // æ£€æŸ¥å…³é”®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                const filesToCheck = [
                    '/assets/js/global-loading-screen.js',
                    '/force-logo-fix.js',
                    '/assets/css/loading-screen-fix.css',
                    '/pages/products.html',
                    '/simple-product-test.html'
                ];
                
                let statusHTML = '<h4>ğŸ“ æ–‡ä»¶çŠ¶æ€æ£€æŸ¥:</h4>';
                
                for (const file of filesToCheck) {
                    try {
                        const response = await fetch(file, { method: 'HEAD' });
                        const status = response.ok ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨';
                        const statusClass = response.ok ? 'success' : 'danger';
                        statusHTML += `<div class="status ${statusClass}">${file}: ${status}</div>`;
                        log(`æ–‡ä»¶æ£€æŸ¥ ${file}: ${status}`, response.ok ? 'success' : 'error');
                    } catch (error) {
                        statusHTML += `<div class="status danger">${file}: âŒ æ£€æŸ¥å¤±è´¥</div>`;
                        log(`æ–‡ä»¶æ£€æŸ¥ ${file}: æ£€æŸ¥å¤±è´¥ - ${error.message}`, 'error');
                    }
                }
                
                // æ£€æŸ¥APIç«¯ç‚¹
                statusHTML += '<h4>ğŸ”Œ APIç«¯ç‚¹æ£€æŸ¥:</h4>';
                try {
                    const apiResponse = await fetch('/api/public/products?limit=1');
                    const apiStatus = apiResponse.ok ? 'âœ… æ­£å¸¸' : `âŒ é”™è¯¯ (${apiResponse.status})`;
                    const apiClass = apiResponse.ok ? 'success' : 'warning';
                    statusHTML += `<div class="status ${apiClass}">äº§å“API: ${apiStatus}</div>`;
                    log(`APIæ£€æŸ¥: ${apiStatus}`, apiResponse.ok ? 'success' : 'warning');
                } catch (error) {
                    statusHTML += `<div class="status danger">äº§å“API: âŒ è¿æ¥å¤±è´¥</div>`;
                    log(`APIæ£€æŸ¥: è¿æ¥å¤±è´¥ - ${error.message}`, 'error');
                }
                
                statusElement.innerHTML = statusHTML;
                
            } catch (error) {
                statusElement.innerHTML = `<div class="status danger">âŒ ä¿®å¤çŠ¶æ€æ£€æŸ¥å¤±è´¥: ${error.message}</div>`;
                log(`ä¿®å¤çŠ¶æ€æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ¸…é™¤æ—¥å¿—
        function clearLogs() {
            document.getElementById('logs').textContent = 'æ—¥å¿—å·²æ¸…é™¤...\n';
            log('æ—¥å¿—å·²æ¸…é™¤', 'info');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            log('é¡µé¢è¯Šæ–­å·¥å…·å·²å¯åŠ¨', 'success');
            
            // è‡ªåŠ¨æ£€æŸ¥ä¿®å¤çŠ¶æ€
            setTimeout(() => {
                checkFixStatus();
            }, 1000);
            
            // ç›‘æ§é¡µé¢è·³è½¬
            const originalPushState = history.pushState;
            const originalReplaceState = history.replaceState;
            
            history.pushState = function() {
                log(`æ£€æµ‹åˆ°é¡µé¢è·³è½¬ (pushState): ${arguments[2]}`, 'info');
                return originalPushState.apply(history, arguments);
            };
            
            history.replaceState = function() {
                log(`æ£€æµ‹åˆ°é¡µé¢è·³è½¬ (replaceState): ${arguments[2]}`, 'info');
                return originalReplaceState.apply(history, arguments);
            };
            
            // ç›‘æ§locationå˜åŒ–
            let currentLocation = window.location.href;
            setInterval(() => {
                if (window.location.href !== currentLocation) {
                    log(`æ£€æµ‹åˆ°URLå˜åŒ–: ${currentLocation} -> ${window.location.href}`, 'warning');
                    currentLocation = window.location.href;
                }
            }, 1000);
        });
        
        // é”™è¯¯æ•è·
        window.addEventListener('error', function(e) {
            log(`JavaScripté”™è¯¯: ${e.message} (${e.filename}:${e.lineno})`, 'error');
        });
        
        log('è¯Šæ–­å·¥å…·åˆå§‹åŒ–å®Œæˆ', 'success');
    </script>
</body>
</html>
