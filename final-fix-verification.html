<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‰ æœ€ç»ˆä¿®å¤éªŒè¯ - Diamond Website</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .verification-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .verification-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .card-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #ffd700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }
        .status-ok { color: #4CAF50; font-weight: bold; }
        .status-error { color: #f44336; font-weight: bold; }
        .status-warning { color: #ff9800; font-weight: bold; }
        .status-pending { color: #2196F3; font-weight: bold; }
        .button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .button.primary { background: linear-gradient(45deg, #2196F3, #1976D2); }
        .button.success { background: linear-gradient(45deg, #4CAF50, #45a049); }
        .button.warning { background: linear-gradient(45deg, #ff9800, #f57c00); }
        .summary {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }
        .summary h2 {
            margin-top: 0;
            color: #ffd700;
        }
        .logs {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‰ æœ€ç»ˆä¿®å¤éªŒè¯</h1>
        
        <div class="verification-grid">
            <div class="verification-card">
                <div class="card-title">
                    <span>ğŸŒ</span>
                    <span>æœåŠ¡å™¨å’ŒAPIçŠ¶æ€</span>
                </div>
                <div class="test-item">
                    <span>Node.jsæœåŠ¡å™¨</span>
                    <span id="server-status" class="status-pending">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="test-item">
                    <span>äº§å“API</span>
                    <span id="products-api-status" class="status-pending">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="test-item">
                    <span>åˆ†ç±»API</span>
                    <span id="categories-api-status" class="status-pending">æ£€æŸ¥ä¸­...</span>
                </div>
            </div>
            
            <div class="verification-card">
                <div class="card-title">
                    <span>ğŸ </span>
                    <span>ä¸»é¡µåŠŸèƒ½çŠ¶æ€</span>
                </div>
                <div class="test-item">
                    <span>è½®æ’­å›¾</span>
                    <span id="carousel-status" class="status-pending">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="test-item">
                    <span>äº§å“å±•ç¤º</span>
                    <span id="homepage-products-status" class="status-pending">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="test-item">
                    <span>é¡µé¢å¯¼èˆª</span>
                    <span id="homepage-navigation-status" class="status-pending">æ£€æŸ¥ä¸­...</span>
                </div>
            </div>
            
            <div class="verification-card">
                <div class="card-title">
                    <span>ğŸ“œ</span>
                    <span>ä¿®å¤è„šæœ¬çŠ¶æ€</span>
                </div>
                <div class="test-item">
                    <span>åŒé‡åˆ·æ–°ä¿®å¤</span>
                    <span id="double-refresh-fix-status" class="status-pending">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="test-item">
                    <span>é¡µé¢è·³è½¬ä¿®å¤</span>
                    <span id="page-transition-fix-status" class="status-pending">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="test-item">
                    <span>ç»„ä»¶ç®¡ç†å™¨</span>
                    <span id="component-manager-status" class="status-pending">æ£€æŸ¥ä¸­...</span>
                </div>
            </div>
            
            <div class="verification-card">
                <div class="card-title">
                    <span>ğŸ”—</span>
                    <span>é¡µé¢è®¿é—®æµ‹è¯•</span>
                </div>
                <div class="test-item">
                    <span>äº§å“é¡µé¢</span>
                    <span id="products-page-status" class="status-pending">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="test-item">
                    <span>å…³äºé¡µé¢</span>
                    <span id="about-page-status" class="status-pending">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="test-item">
                    <span>è”ç³»é¡µé¢</span>
                    <span id="contact-page-status" class="status-pending">æ£€æŸ¥ä¸­...</span>
                </div>
            </div>
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <button class="button success" onclick="runFullVerification()">ğŸ” å®Œæ•´éªŒè¯</button>
            <a href="/" class="button primary" target="_blank">ğŸ  æµ‹è¯•ä¸»é¡µ</a>
            <a href="/pages/products.html" class="button primary" target="_blank">ğŸ“¦ æµ‹è¯•äº§å“é¡µ</a>
            <a href="/pages/about.html" class="button primary" target="_blank">â„¹ï¸ æµ‹è¯•å…³äºé¡µ</a>
            <button class="button warning" onclick="clearLogs()">ğŸ—‘ï¸ æ¸…é™¤æ—¥å¿—</button>
        </div>
        
        <div class="summary" id="summary" style="display: none;">
            <h2>ğŸ“Š éªŒè¯ç»“æœæ€»ç»“</h2>
            <div id="summary-content"></div>
        </div>
        
        <div class="logs" id="logs">
            <div style="color: #4CAF50;">[å¯åŠ¨] ğŸ‰ æœ€ç»ˆä¿®å¤éªŒè¯å·¥å…·å·²å¯åŠ¨</div>
        </div>
    </div>

    <script>
        let testResults = {};
        
        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                success: '#4CAF50',
                error: '#f44336',
                warning: '#ff9800',
                info: '#2196F3'
            };
            
            const entry = document.createElement('div');
            entry.innerHTML = `<span style="color: #888;">[${timestamp}]</span> <span style="color: ${colors[type] || colors.info};">${message}</span>`;
            logs.appendChild(entry);
            logs.scrollTop = logs.scrollHeight;
        }
        
        function updateStatus(elementId, status, success = true) {
            const element = document.getElementById(elementId);
            element.textContent = status;
            element.className = success ? 'status-ok' : 'status-error';
            testResults[elementId] = success;
        }
        
        async function checkServerAndAPI() {
            log('ğŸŒ æ£€æŸ¥æœåŠ¡å™¨å’ŒAPIçŠ¶æ€...', 'info');
            
            try {
                // æ£€æŸ¥æœåŠ¡å™¨
                const serverResponse = await fetch('/');
                updateStatus('server-status', serverResponse.ok ? 'âœ… æ­£å¸¸' : 'âŒ å¼‚å¸¸', serverResponse.ok);
                log(`æœåŠ¡å™¨çŠ¶æ€: ${serverResponse.ok ? 'æ­£å¸¸' : 'å¼‚å¸¸'}`, serverResponse.ok ? 'success' : 'error');
                
                // æ£€æŸ¥äº§å“API
                const productsResponse = await fetch('/api/public/products');
                if (productsResponse.ok) {
                    const data = await productsResponse.json();
                    const count = data.products ? data.products.length : 0;
                    updateStatus('products-api-status', `âœ… ${count}ä¸ªäº§å“`, true);
                    log(`äº§å“API: æ­£å¸¸ (${count}ä¸ªäº§å“)`, 'success');
                } else {
                    updateStatus('products-api-status', 'âŒ å¼‚å¸¸', false);
                    log('äº§å“API: å¼‚å¸¸', 'error');
                }
                
                // æ£€æŸ¥åˆ†ç±»API
                const categoriesResponse = await fetch('/api/public/categories');
                if (categoriesResponse.ok) {
                    const categories = await categoriesResponse.json();
                    updateStatus('categories-api-status', `âœ… ${categories.length || 0}ä¸ªåˆ†ç±»`, true);
                    log(`åˆ†ç±»API: æ­£å¸¸ (${categories.length || 0}ä¸ªåˆ†ç±»)`, 'success');
                } else {
                    updateStatus('categories-api-status', 'âŒ å¼‚å¸¸', false);
                    log('åˆ†ç±»API: å¼‚å¸¸', 'error');
                }
                
            } catch (error) {
                log(`APIæ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                updateStatus('server-status', 'âŒ ç¦»çº¿', false);
                updateStatus('products-api-status', 'âŒ å¤±è´¥', false);
                updateStatus('categories-api-status', 'âŒ å¤±è´¥', false);
            }
        }
        
        function checkHomepageFunctionality() {
            log('ğŸ  æ£€æŸ¥ä¸»é¡µåŠŸèƒ½çŠ¶æ€...', 'info');
            
            // æ£€æŸ¥è½®æ’­å›¾
            const carouselExists = typeof CarouselManager !== 'undefined';
            updateStatus('carousel-status', carouselExists ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½', carouselExists);
            log(`è½®æ’­å›¾ç®¡ç†å™¨: ${carouselExists ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}`, carouselExists ? 'success' : 'error');
            
            // æ£€æŸ¥äº§å“å±•ç¤ºå‡½æ•°
            const homepageProductsExists = typeof window.loadHomepageProducts === 'function';
            updateStatus('homepage-products-status', homepageProductsExists ? 'âœ… å·²é…ç½®' : 'âŒ æœªé…ç½®', homepageProductsExists);
            log(`ä¸»é¡µäº§å“åŠ è½½: ${homepageProductsExists ? 'å·²é…ç½®' : 'æœªé…ç½®'}`, homepageProductsExists ? 'success' : 'error');
            
            // æ£€æŸ¥å¯¼èˆª
            const navExists = document.querySelector('nav') !== null;
            updateStatus('homepage-navigation-status', navExists ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±', navExists);
            log(`é¡µé¢å¯¼èˆª: ${navExists ? 'å­˜åœ¨' : 'ç¼ºå¤±'}`, navExists ? 'success' : 'error');
        }
        
        function checkFixScripts() {
            log('ğŸ“œ æ£€æŸ¥ä¿®å¤è„šæœ¬çŠ¶æ€...', 'info');
            
            // æ£€æŸ¥åŒé‡åˆ·æ–°ä¿®å¤
            const doubleRefreshExists = typeof window.PageExecutionState !== 'undefined';
            updateStatus('double-refresh-fix-status', doubleRefreshExists ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½', doubleRefreshExists);
            log(`åŒé‡åˆ·æ–°ä¿®å¤: ${doubleRefreshExists ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}`, doubleRefreshExists ? 'success' : 'error');
            
            // æ£€æŸ¥é¡µé¢è·³è½¬ä¿®å¤
            const pageTransitionExists = typeof window.forceRemoveLoadingScreens !== 'undefined';
            updateStatus('page-transition-fix-status', pageTransitionExists ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½', pageTransitionExists);
            log(`é¡µé¢è·³è½¬ä¿®å¤: ${pageTransitionExists ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}`, pageTransitionExists ? 'success' : 'error');
            
            // æ£€æŸ¥ç»„ä»¶ç®¡ç†å™¨
            const componentManagerExists = typeof window.componentManager !== 'undefined';
            updateStatus('component-manager-status', componentManagerExists ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½', componentManagerExists);
            log(`ç»„ä»¶ç®¡ç†å™¨: ${componentManagerExists ? 'å·²åŠ è½½' : 'æœªåŠ è½½'}`, componentManagerExists ? 'success' : 'error');
        }
        
        async function checkPageAccess() {
            log('ğŸ”— æ£€æŸ¥é¡µé¢è®¿é—®çŠ¶æ€...', 'info');
            
            const pages = [
                { id: 'products-page-status', url: '/pages/products.html', name: 'äº§å“é¡µé¢' },
                { id: 'about-page-status', url: '/pages/about.html', name: 'å…³äºé¡µé¢' },
                { id: 'contact-page-status', url: '/pages/contact.html', name: 'è”ç³»é¡µé¢' }
            ];
            
            for (const page of pages) {
                try {
                    const response = await fetch(page.url);
                    updateStatus(page.id, response.ok ? 'âœ… å¯è®¿é—®' : 'âŒ ä¸å¯è®¿é—®', response.ok);
                    log(`${page.name}: ${response.ok ? 'å¯è®¿é—®' : 'ä¸å¯è®¿é—®'}`, response.ok ? 'success' : 'error');
                } catch (error) {
                    updateStatus(page.id, 'âŒ å¤±è´¥', false);
                    log(`${page.name}: è®¿é—®å¤±è´¥`, 'error');
                }
            }
        }
        
        function showSummary() {
            const summary = document.getElementById('summary');
            const content = document.getElementById('summary-content');
            
            const totalTests = Object.keys(testResults).length;
            const passedTests = Object.values(testResults).filter(result => result).length;
            const failedTests = totalTests - passedTests;
            
            const successRate = totalTests > 0 ? Math.round((passedTests / totalTests) * 100) : 0;
            
            let summaryHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0;">
                    <div style="background: rgba(76, 175, 80, 0.2); padding: 15px; border-radius: 8px;">
                        <div style="font-size: 2em; font-weight: bold; color: #4CAF50;">${passedTests}</div>
                        <div>é€šè¿‡æµ‹è¯•</div>
                    </div>
                    <div style="background: rgba(244, 67, 54, 0.2); padding: 15px; border-radius: 8px;">
                        <div style="font-size: 2em; font-weight: bold; color: #f44336;">${failedTests}</div>
                        <div>å¤±è´¥æµ‹è¯•</div>
                    </div>
                    <div style="background: rgba(33, 150, 243, 0.2); padding: 15px; border-radius: 8px;">
                        <div style="font-size: 2em; font-weight: bold; color: #2196F3;">${successRate}%</div>
                        <div>æˆåŠŸç‡</div>
                    </div>
                </div>
            `;
            
            if (successRate >= 90) {
                summaryHTML += `<div style="color: #4CAF50; font-size: 1.2em; font-weight: bold;">ğŸ‰ ä¿®å¤æˆåŠŸï¼ç½‘ç«™åŠŸèƒ½åŸºæœ¬æ¢å¤æ­£å¸¸ã€‚</div>`;
            } else if (successRate >= 70) {
                summaryHTML += `<div style="color: #ff9800; font-size: 1.2em; font-weight: bold;">âš ï¸ éƒ¨åˆ†åŠŸèƒ½éœ€è¦è¿›ä¸€æ­¥ä¿®å¤ã€‚</div>`;
            } else {
                summaryHTML += `<div style="color: #f44336; font-size: 1.2em; font-weight: bold;">âŒ ä»æœ‰é‡è¦åŠŸèƒ½éœ€è¦ä¿®å¤ã€‚</div>`;
            }
            
            content.innerHTML = summaryHTML;
            summary.style.display = 'block';
        }
        
        async function runFullVerification() {
            log('ğŸ” å¼€å§‹å®Œæ•´éªŒè¯...', 'info');
            testResults = {};
            
            await checkServerAndAPI();
            checkHomepageFunctionality();
            checkFixScripts();
            await checkPageAccess();
            
            showSummary();
            log('âœ… å®Œæ•´éªŒè¯å®Œæˆ', 'success');
        }
        
        function clearLogs() {
            document.getElementById('logs').innerHTML = '<div style="color: #4CAF50;">[æ¸…é™¤] ğŸ—‘ï¸ æ—¥å¿—å·²æ¸…é™¤</div>';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒéªŒè¯
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(runFullVerification, 1000);
        });
    </script>
</body>
</html>
