<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª ç®€åŒ–äº§å“æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .warning { background: #fff3cd; color: #856404; }
        .danger { background: #f8d7da; color: #721c24; }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .product-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #f9f9f9;
        }
        .product-card h4 {
            color: #333;
            margin: 0 0 10px 0;
        }
        .product-card p {
            color: #666;
            margin: 5px 0;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ç®€åŒ–äº§å“é¡µé¢æµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•äº§å“æ•°æ®åŠ è½½åŠŸèƒ½ï¼Œä¸ä¾èµ–å¤æ‚çš„ç»„ä»¶ç³»ç»Ÿã€‚</p>
        
        <div id="status" class="status warning">
            â³ æ­£åœ¨åˆå§‹åŒ–...
        </div>
        
        <div>
            <button class="btn" onclick="testBasicJS()">æµ‹è¯•åŸºç¡€JavaScript</button>
            <button class="btn" onclick="loadTestProducts()">åŠ è½½æµ‹è¯•äº§å“</button>
            <button class="btn" onclick="testAPI()">æµ‹è¯•API</button>
            <button class="btn" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>
        
        <div id="productCount" style="font-size: 18px; font-weight: bold; margin: 20px 0;">
            å…±0ä¸ªäº§å“
        </div>
        
        <div id="productGrid" class="product-grid">
            <!-- äº§å“å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
        
        <div id="logs" style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 20px 0; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;">
            <strong>æ—¥å¿—è¾“å‡ºï¼š</strong><br>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let testProducts = [];
        
        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('logs');
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : type === 'warning' ? 'orange' : 'black';
            logElement.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span><br>`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        // æ›´æ–°çŠ¶æ€
        function updateStatus(message, type = 'warning') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }
        
        // æ›´æ–°äº§å“è®¡æ•°
        function updateProductCount(count) {
            const countElement = document.getElementById('productCount');
            countElement.textContent = `å…±${count}ä¸ªäº§å“`;
            log(`äº§å“è®¡æ•°æ›´æ–°: ${count}`, 'info');
        }
        
        // æ¸²æŸ“äº§å“
        function renderProducts(products) {
            const grid = document.getElementById('productGrid');
            
            if (!products || products.length === 0) {
                grid.innerHTML = '<div style="text-align: center; color: #666; padding: 40px;">æš‚æ— äº§å“æ•°æ®</div>';
                updateProductCount(0);
                return;
            }
            
            grid.innerHTML = products.map(product => `
                <div class="product-card">
                    <h4>${product.name || 'æœªçŸ¥äº§å“'}</h4>
                    <p><strong>å“ç‰Œ:</strong> ${product.brand || 'æœªçŸ¥å“ç‰Œ'}</p>
                    <p><strong>åˆ†ç±»:</strong> ${product.category || 'æœªçŸ¥åˆ†ç±»'}</p>
                    <p><strong>å‹å·:</strong> ${product.model || 'æœªçŸ¥å‹å·'}</p>
                    <p><strong>æè¿°:</strong> ${product.description || 'æš‚æ— æè¿°'}</p>
                </div>
            `).join('');
            
            updateProductCount(products.length);
            log(`äº§å“æ¸²æŸ“å®Œæˆ: ${products.length}ä¸ªäº§å“`, 'success');
        }
        
        // æµ‹è¯•åŸºç¡€JavaScript
        function testBasicJS() {
            log('å¼€å§‹æµ‹è¯•åŸºç¡€JavaScriptåŠŸèƒ½...', 'info');
            
            try {
                // æµ‹è¯•åŸºæœ¬åŠŸèƒ½
                const testArray = [1, 2, 3];
                const testObject = { name: 'test', value: 123 };
                const testString = 'Hello World';
                
                log(`æ•°ç»„æµ‹è¯•: ${JSON.stringify(testArray)}`, 'success');
                log(`å¯¹è±¡æµ‹è¯•: ${JSON.stringify(testObject)}`, 'success');
                log(`å­—ç¬¦ä¸²æµ‹è¯•: ${testString}`, 'success');
                
                // æµ‹è¯•DOMæ“ä½œ
                const testDiv = document.createElement('div');
                testDiv.textContent = 'æµ‹è¯•å…ƒç´ ';
                log('DOMæ“ä½œæµ‹è¯•: æˆåŠŸ', 'success');
                
                updateStatus('âœ… JavaScriptåŸºç¡€åŠŸèƒ½æ­£å¸¸', 'success');
                
            } catch (error) {
                log(`JavaScriptæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateStatus('âŒ JavaScriptåŸºç¡€åŠŸèƒ½å¼‚å¸¸', 'danger');
            }
        }
        
        // åŠ è½½æµ‹è¯•äº§å“
        function loadTestProducts() {
            log('å¼€å§‹åŠ è½½æµ‹è¯•äº§å“æ•°æ®...', 'info');
            
            try {
                testProducts = [
                    {
                        id: "GT1749V",
                        name: "GT1749V æ¶¡è½®å¢å‹å™¨æ€»æˆ",
                        brand: "Garrett",
                        category: "turbocharger",
                        model: "GT1749V-724930",
                        description: "é€‚ç”¨äºå¤§ä¼—ã€å¥¥è¿ª1.9L TDIå‘åŠ¨æœºï¼ŒåŸå‚å“è´¨ï¼Œæ€§èƒ½ç¨³å®š"
                    },
                    {
                        id: "0445120123",
                        name: "0445120123 å…±è½¨å–·æ²¹å™¨",
                        brand: "Bosch",
                        category: "diesel-injection",
                        model: "0445120123",
                        description: "BoschåŸå‚å…±è½¨å–·æ²¹å™¨ï¼Œé€‚ç”¨äºå¤šç§æŸ´æ²¹å‘åŠ¨æœº"
                    }
                ];
                
                log(`æµ‹è¯•äº§å“æ•°æ®åŠ è½½æˆåŠŸ: ${testProducts.length}ä¸ªäº§å“`, 'success');
                renderProducts(testProducts);
                updateStatus('âœ… æµ‹è¯•äº§å“åŠ è½½æˆåŠŸ', 'success');
                
            } catch (error) {
                log(`æµ‹è¯•äº§å“åŠ è½½å¤±è´¥: ${error.message}`, 'error');
                updateStatus('âŒ æµ‹è¯•äº§å“åŠ è½½å¤±è´¥', 'danger');
            }
        }
        
        // æµ‹è¯•API
        function testAPI() {
            log('å¼€å§‹æµ‹è¯•APIæ¥å£...', 'info');
            updateStatus('â³ æ­£åœ¨æµ‹è¯•API...', 'warning');
            
            fetch('/api/public/products?limit=10')
                .then(response => {
                    log(`APIå“åº”çŠ¶æ€: ${response.status}`, response.ok ? 'success' : 'warning');
                    
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error(`APIè¿”å›é”™è¯¯çŠ¶æ€: ${response.status}`);
                    }
                })
                .then(data => {
                    log(`APIæ•°æ®è·å–æˆåŠŸ: ${JSON.stringify(data).substring(0, 100)}...`, 'success');
                    
                    const products = data.data || data.products || data || [];
                    log(`è§£æåˆ°äº§å“æ•°é‡: ${products.length}`, 'info');
                    
                    if (products.length > 0) {
                        renderProducts(products);
                        updateStatus('âœ… APIæµ‹è¯•æˆåŠŸ', 'success');
                    } else {
                        log('APIè¿”å›ç©ºæ•°æ®ï¼Œä½¿ç”¨æµ‹è¯•æ•°æ®', 'warning');
                        loadTestProducts();
                        updateStatus('âš ï¸ APIè¿”å›ç©ºæ•°æ®ï¼Œå·²åŠ è½½æµ‹è¯•æ•°æ®', 'warning');
                    }
                })
                .catch(error => {
                    log(`APIæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                    log('APIå¤±è´¥ï¼Œå°è¯•åŠ è½½æµ‹è¯•æ•°æ®...', 'warning');
                    loadTestProducts();
                    updateStatus('âš ï¸ APIå¤±è´¥ï¼Œå·²åŠ è½½æµ‹è¯•æ•°æ®', 'warning');
                });
        }
        
        // æ¸…é™¤ç»“æœ
        function clearResults() {
            testProducts = [];
            renderProducts([]);
            document.getElementById('logs').innerHTML = '<strong>æ—¥å¿—è¾“å‡ºï¼š</strong><br>';
            updateStatus('ğŸ”„ å·²æ¸…é™¤æ‰€æœ‰ç»“æœ', 'warning');
            log('ç»“æœå·²æ¸…é™¤', 'info');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            log('é¡µé¢DOMåŠ è½½å®Œæˆ', 'success');
            updateStatus('âœ… é¡µé¢åˆå§‹åŒ–å®Œæˆ', 'success');
            
            // è‡ªåŠ¨æµ‹è¯•åŸºç¡€åŠŸèƒ½
            setTimeout(() => {
                testBasicJS();
            }, 500);
            
            // è‡ªåŠ¨å°è¯•åŠ è½½äº§å“
            setTimeout(() => {
                testAPI();
            }, 1000);
        });
        
        // é¡µé¢å®Œå…¨åŠ è½½å
        window.addEventListener('load', function() {
            log('é¡µé¢å®Œå…¨åŠ è½½å®Œæˆ', 'success');
        });
        
        // é”™è¯¯æ•è·
        window.addEventListener('error', function(e) {
            log(`JavaScripté”™è¯¯: ${e.message} (${e.filename}:${e.lineno})`, 'error');
            updateStatus('âŒ æ£€æµ‹åˆ°JavaScripté”™è¯¯', 'danger');
        });
        
        log('è„šæœ¬åˆå§‹åŒ–å®Œæˆ', 'success');
    </script>
</body>
</html>
