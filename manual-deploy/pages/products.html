<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n="products.page_title">
      äº§å“å±•ç¤º - æ— é”¡çš‡å¾·å›½é™…è´¸æ˜“æœ‰é™å…¬å¸
    </title>
    <meta
      name="description"
      data-i18n-attr="content"
      data-i18n="products.page_description"
      content="æ— é”¡çš‡å¾·å›½é™…è´¸æ˜“æœ‰é™å…¬å¸ä¸“ä¸šæä¾›æ¶¡è½®å¢å‹å™¨ã€æ‰§è¡Œå™¨ã€æŸ´æ²¹å–·å°„ç³»ç»Ÿç­‰äº§å“"
    />
    <meta
      name="keywords"
      data-i18n-attr="content"
      data-i18n="products.page_keywords"
      content="æ¶¡è½®å¢å‹å™¨,æ‰§è¡Œå™¨,æŸ´æ²¹å–·å°„ç³»ç»Ÿ,å…±è½¨å–·æ²¹å™¨,æ— é”¡çš‡å¾·"
    />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon.ico" />

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="../assets/css/font-awesome.min.css" />

    <!-- ä¸»è¦æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="../assets/css/main.css" />

    <!-- å›½é™…åŒ–æ ·å¼ -->
    <link rel="stylesheet" href="../assets/css/i18n-styles.css" />

    <style>
      /* åŠ è½½å±å¹•æ ·å¼ */
      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: linear-gradient(135deg, #002e5f 0%, #001a3a 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        transition: all 0.5s ease;
      }

      .loading-screen.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
      }

      .loading-content {
        text-align: center;
        color: white;
      }

      .loading-logo {
        margin-bottom: 20px;
      }

      .loading-logo-img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      .loading-company-name {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 10px;
        color: white;
      }

      .loading-subtitle {
        font-size: 16px;
        margin-bottom: 30px;
        opacity: 0.8;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      .loading-text {
        font-size: 14px;
        opacity: 0.7;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      /* äº§å“é¡µé¢ä¸“ç”¨æ ·å¼ */
      .products-hero {
        background: linear-gradient(135deg, #002e5f 0%, #001a3a 100%);
        color: white;
        padding: 120px 0 60px;
        text-align: center;
        margin-top: 90px; /* ä¸ºå›ºå®šå¯¼èˆªæ ç•™å‡ºç©ºé—´ */
      }

      .products-hero h1 {
        font-size: 48px;
        margin-bottom: 20px;
        font-weight: 700;
      }

      .products-hero p {
        font-size: 20px;
        opacity: 0.9;
        max-width: 600px;
        margin: 0 auto;
      }

      .products-filters {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        padding: 25px 0;
        box-shadow: 0 4px 20px rgba(0, 46, 95, 0.1);
        position: sticky;
        top: 140px; /* å¢åŠ åˆ°140pxï¼Œä¸ºå›ºå®šçš„headerå’Œäº§å“æ ‡ç­¾æ ç•™å‡ºç©ºé—´ */
        z-index: 100;
        border-bottom: 1px solid rgba(0, 46, 95, 0.1);
      }

      .filters-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 40px;
        flex-wrap: wrap;
        max-width: 1000px;
        margin: 0 auto;
      }

      .filter-group {
        display: flex;
        flex-direction: row; /* æ”¹ä¸ºè¡Œæ–¹å‘ */
        align-items: center; /* å‚ç›´å±…ä¸­å¯¹é½ */
        gap: 15px; /* å¢åŠ é—´è· */
        position: relative;
      }

      .filter-group label {
        font-weight: 600;
        color: #002e5f;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        white-space: nowrap;
        margin: 0; /* ç§»é™¤é»˜è®¤è¾¹è· */
      }

      .filter-select {
        padding: 10px 15px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
        min-width: 150px;
        background: white;
        color: #333;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .filter-select:hover {
        border-color: #007bff;
        box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
        transform: translateY(-1px);
      }

      .filter-select:focus {
        outline: none;
        border-color: #007bff;
        box-shadow:
          0 0 0 3px rgba(0, 123, 255, 0.1),
          0 4px 15px rgba(0, 123, 255, 0.2);
        transform: translateY(-1px);
      }

      .search-container {
        display: flex;
        align-items: center;
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        border-radius: 25px;
        box-shadow: 0 2px 8px rgba(0, 46, 95, 0.1);
        transition: all 0.3s ease;
        overflow: hidden;
        position: relative;
      }

      .search-container:hover {
        box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
        transform: translateY(-1px);
      }

      .search-input {
        border: 2px solid #e9ecef;
        border-radius: 25px 0 0 25px;
        padding: 12px 50px 12px 20px;
        font-size: 14px;
        width: 250px;
        background: transparent;
        transition: all 0.3s ease;
        border-right: none;
      }

      .search-input:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
      }

      /* äº§å“ç­›é€‰åŒºåŸŸçš„æœç´¢æŒ‰é’®æ ·å¼ */
      .products-filters .search-btn {
        position: absolute;
        right: 105px; /* ç²¾ç¡®å®šä½åœ¨æœç´¢æ¡†å³è¾¹ç¼˜ */
        top: 50%;
        transform: translateY(-50%);
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 10;
      }

      .products-filters .search-btn:hover {
        background: linear-gradient(135deg, #0056b3 0%, #004085 100%);
        transform: translateY(-50%) scale(1.1);
      }

      .search-results-count {
        padding: 12px 20px;
        background: #f8fafc;
        border: 2px solid #e9ecef;
        border-left: none;
        border-radius: 0 25px 25px 0;
        min-width: 100px;
        text-align: center;
        transition: all 0.3s ease;
      }

      .count-text {
        font-size: 14px;
        color: #64748b;
        font-weight: 500;
      }

      .products-main {
        padding: 50px 0;
        background: #f8f9fa;
      }

      /* äº§å“ç½‘æ ¼å¸ƒå±€ */
      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 30px;
        padding: 30px 0;
      }

      /* äº§å“æ ‡ç­¾æ ·å¼ */
      .product-badges {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        flex-direction: column;
        gap: 5px;
        z-index: 2;
      }

      /* äº§å“ç‰¹æ€§æ ·å¼ */
      .product-features {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 15px;
      }

      .feature-tag {
        background: linear-gradient(135deg, #00dc82 0%, #00b76c 100%);
        color: white;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        box-shadow: 0 2px 8px rgba(0, 220, 130, 0.25);
        letter-spacing: 0.2px;
        border: none;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 5px;
        margin: 0;
        cursor: default;
      }

      .feature-tag:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 220, 130, 0.3);
        background: linear-gradient(135deg, #00b76c 0%, #009c5a 100%);
      }

      .feature-tag i {
        color: rgba(255, 255, 255, 0.9);
        font-size: 11px;
        margin-right: 2px;
      }

      .feature-tag .feature-text {
        font-weight: 500;
        letter-spacing: 0.1px;
      }

      .no-results {
        text-align: center;
        padding: 60px 20px;
        color: #666;
      }

      .no-results i {
        font-size: 48px;
        margin-bottom: 20px;
        color: #ddd;
      }

      .no-results h3 {
        font-size: 24px;
        margin-bottom: 10px;
      }

      .no-results p {
        font-size: 16px;
      }

      /* å“åº”å¼è°ƒæ•´ */
      @media (max-width: 768px) {
        .products-hero h1 {
          font-size: 36px;
        }

        .products-hero p {
          font-size: 18px;
        }

        .filters-container {
          flex-direction: column;
          gap: 20px;
        }

        .search-input {
          width: 180px;
        }

        .products-filters .search-btn {
          right: 85px; /* åœ¨ç§»åŠ¨ç«¯è°ƒæ•´æœç´¢æŒ‰é’®ä½ç½® */
        }

        .search-results-count {
          min-width: 80px;
          padding: 12px 15px;
        }

        .count-text {
          font-size: 13px;
        }

        .products-grid {
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 20px;
          padding: 20px 0;
        }
        .filter-group {
          flex-direction: row; /* ä¿æŒè¡Œæ–¹å‘ */
          width: 100%; /* åœ¨ç§»åŠ¨ç«¯å æ»¡å®½åº¦ */
          justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ */
        }

        .filter-select {
          flex: 1; /* è®©é€‰æ‹©æ¡†å æ®å‰©ä½™ç©ºé—´ */
          min-width: 0; /* å…è®¸æ”¶ç¼© */
        }

        .feature-tag {
          padding: 5px 12px;
          font-size: 11px;
          border-radius: 18px;
        }

        .feature-tag i {
          font-size: 10px;
        }

        .product-name {
          font-size: 16px;
        }

        .product-description {
          font-size: 13px;
        }

        .product-actions {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <!-- é¡µå¤´ç»„ä»¶å®¹å™¨ -->
    <div id="header-container"></div>

    <!-- ä¸»è¦å†…å®¹ -->
    <main>
      <!-- äº§å“é¡µé¢æ ‡é¢˜åŒºåŸŸ -->
      <section class="products-hero">
        <div class="container">
          <h1 data-i18n="products.title">äº§å“å±•ç¤º</h1>
          <p data-i18n="products.subtitle">
            ä¸“ä¸šçš„æ¶¡è½®å¢å‹å™¨å’Œå…±è½¨å–·æ²¹å™¨é…ä»¶ï¼Œä¸ºæ‚¨çš„è®¾å¤‡æä¾›æœ€ä½³æ€§èƒ½ä¿éšœ
          </p>
        </div>
      </section>

      <!-- äº§å“ç­›é€‰åŒºåŸŸ -->
      <section class="products-filters">
        <div class="container">
          <div class="filters-container">
            <div class="filter-group">
              <label for="categoryFilter" data-i18n="products.category_filter"
                >äº§å“åˆ†ç±»:</label
              >
              <select
                id="categoryFilter"
                class="filter-select"
                onchange="filterByCategory(this.value)"
              >
                <option value="all" data-i18n="categories.all">å…¨éƒ¨äº§å“</option>
                <!-- åˆ†ç±»é€‰é¡¹å°†ä»APIåŠ¨æ€åŠ è½½ -->
              </select>
            </div>

            <div class="filter-group">
              <label for="brandFilter" data-i18n="products.brand_filter"
                >å“ç‰Œç­›é€‰:</label
              >
              <select
                id="brandFilter"
                class="filter-select"
                onchange="filterByBrand(this.value)"
              >
                <option value="all" data-i18n="products.all_brands">
                  å…¨éƒ¨å“ç‰Œ
                </option>
                <option value="Garrett">Garrett</option>
                <option value="Bosch">Bosch</option>
                <option value="Pierburg">Pierburg</option>
                <option value="Continental">Continental</option>
                <option value="Delphi">Delphi</option>
                <option value="Johnson Matthey">Johnson Matthey</option>
                <option value="Diamond-Auto">Diamond-Auto</option>
              </select>
            </div>

            <div class="search-container">
              <input
                type="text"
                id="productSearch"
                class="search-input"
                data-i18n-attr="placeholder"
                data-i18n="products.search_placeholder"
                placeholder="æœç´¢äº§å“åç§°æˆ–å‹å·..."
                oninput="searchProducts(this.value)"
              />
              <button
                class="search-btn"
                onclick="searchProducts(document.getElementById('productSearch').value)"
              >
                <i class="fas fa-search"></i>
              </button>
              <div class="search-results-count" id="searchResultsCount">
                <span
                  class="count-text"
                  data-i18n="products.total_products"
                  data-i18n-params='{"count": "0"}'
                  >å…±0ä¸ªäº§å“</span
                >
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- äº§å“å±•ç¤ºåŒºåŸŸ -->
      <section class="products-main">
        <div class="container">
          <div class="products-grid" id="productsGrid">
            <!-- äº§å“å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
          </div>

          <!-- åˆ†é¡µæ§åˆ¶å™¨ -->
          <div class="pagination-controls">
            <div class="page-size-control">
              <label for="pageSize" data-i18n="pagination.items_per_page"
                >æ¯é¡µæ˜¾ç¤ºï¼š</label
              >
              <select id="pageSize" class="page-size-select">
                <option value="12" data-i18n="pagination.items_12">12æ¡</option>
                <option value="24" data-i18n="pagination.items_24">24æ¡</option>
                <option value="36" data-i18n="pagination.items_36">36æ¡</option>
                <option value="48" data-i18n="pagination.items_48">48æ¡</option>
              </select>
            </div>
            <div class="page-jump-control">
              <label for="pageNumber" data-i18n="pagination.jump_to"
                >è·³è½¬åˆ°ï¼š</label
              >
              <input
                type="number"
                id="pageNumber"
                class="page-jump-input"
                min="1"
                data-i18n-attr="placeholder"
                data-i18n="pagination.page_number_placeholder"
                placeholder="é¡µç "
              />
              <button class="page-jump-button" onclick="jumpToPage()">
                <i class="fas fa-arrow-right"></i>
                <span data-i18n="pagination.jump">è·³è½¬</span>
              </button>
            </div>
          </div>

          <!-- åˆ†é¡µå®¹å™¨ -->
          <div class="pagination-container" id="pagination">
            <!-- åˆ†é¡µæŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
          </div>

          <!-- æ— ç»“æœæç¤º -->
          <div id="noResults" class="no-results" style="display: none">
            <i class="fas fa-search"></i>
            <h3 data-i18n="products.no_results_title">æœªæ‰¾åˆ°ç›¸å…³äº§å“</h3>
            <p data-i18n="products.no_results_message">
              è¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–æœç´¢å…³é”®è¯
            </p>
          </div>
        </div>
      </section>
    </main>

    <!-- é¡µè„šç»„ä»¶å®¹å™¨ -->
    <div id="footer-container"></div>

    <!-- åˆ†æè„šæœ¬ -->
    <script src="../assets/js/analytics.js"></script>

    <!-- ğŸ”§ ç»Ÿä¸€ç»„ä»¶ç®¡ç†ç³»ç»Ÿ -->
    <script src="../assets/js/modules/services/company-service.js"></script>
    <script src="../assets/js/modules/components/component-manager.js"></script>
    <script src="../assets/js/unified-component-loader.js"></script>

    <!-- ğŸ†• ç»Ÿä¸€äº§å“å¡ç‰‡ç®¡ç†å™¨ -->
    <script src="../assets/js/modules/components/product-card-manager.js"></script>

    <!-- åˆ†ç±»ç®¡ç†å™¨ -->
    <script src="../assets/js/category-manager.js"></script>

    <!-- äº§å“å¡ç»„ä»¶ï¼ˆå…¼å®¹ç‰ˆæœ¬ï¼‰ -->
    <script src="../assets/js/product-card-component.js"></script>

    <script>
      // å…¨å±€å˜é‡
      let allProducts = [];
      let currentProducts = [];
      let isRendering = false; // æ·»åŠ æ¸²æŸ“æ ‡å¿—ä½

      // è·å–URLå‚æ•°
      function getUrlParameter(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
      }

      // ç›‘å¬åˆ†ç±»æ•°æ®åŠ è½½å®Œæˆäº‹ä»¶
      document.addEventListener("categoriesLoaded", function (event) {
        const { categories, brands } = event.detail;
        console.log("âœ… äº§å“é¡µé¢æ¥æ”¶åˆ°åˆ†ç±»æ•°æ®:", categories.length, "ä¸ªåˆ†ç±»");

        // åªæœ‰åœ¨äº§å“æ•°æ®ä¹Ÿå·²åŠ è½½çš„æƒ…å†µä¸‹æ‰æ›´æ–°ç­›é€‰å™¨
        if (allProducts.length > 0) {
          updateFiltersWithProductData(categories, brands);
        } else {
          console.log(
            "â³ äº§å“æ•°æ®å°šæœªåŠ è½½ï¼Œç­‰å¾…äº§å“æ•°æ®åŠ è½½å®Œæˆåå†æ›´æ–°ç­›é€‰å™¨",
          );
        }
      });

      // æ›´æ–°ç­›é€‰å™¨ï¼ˆåŒ…å«äº§å“æ•°é‡è®¡ç®—ï¼‰
      function updateFiltersWithProductData(categories, brands) {
        if (
          window.categoryManager &&
          !window.categoryManager.isFiltersUpdated
        ) {
          console.log("ğŸ”„ æ›´æ–°åˆ†ç±»å’Œå“ç‰Œç­›é€‰å™¨ï¼ˆåŸºäºäº§å“æ•°æ®ï¼‰");

          // æ›´æ–°åˆ†ç±»ä¸‹æ‹‰æ¡†ï¼ˆåŒ…å«äº§å“æ•°é‡ï¼‰
          updateCategoryFilterWithCounts(categories);

          // æ›´æ–°å“ç‰Œç­›é€‰å™¨
          updateBrandFilter(brands);

          // æ ‡è®°ç­›é€‰å™¨å·²æ›´æ–°
          window.categoryManager.isFiltersUpdated = true;

          // æ£€æŸ¥URLå‚æ•°å¹¶è‡ªåŠ¨ç­›é€‰
          const categoryParam = getUrlParameter("category");
          if (categoryParam) {
            console.log("ğŸ“ æ£€æµ‹åˆ°åˆ†ç±»å‚æ•°:", categoryParam);

            // æ›´æ–°ç­›é€‰å™¨
            const categoryFilter = document.getElementById("categoryFilter");
            if (categoryFilter) {
              categoryFilter.value = categoryParam;
            }

            // æ‰§è¡Œç­›é€‰
            filterByCategory(categoryParam);

            // æ›´æ–°æ ‡ç­¾æŒ‰é’®çŠ¶æ€
            document.querySelectorAll(".tag-btn").forEach((btn) => {
              btn.classList.remove("active");
              if (btn.dataset.category === categoryParam) {
                btn.classList.add("active");
              }
            });
          }
        } else {
          console.log("â­ï¸ ç­›é€‰å™¨å·²æ›´æ–°ï¼Œè·³è¿‡é‡å¤æ›´æ–°");
        }
      }

      // æ›´æ–°åˆ†ç±»ç­›é€‰å™¨é€‰é¡¹ï¼ˆåŒ…å«äº§å“æ•°é‡ï¼‰
      function updateCategoryFilterWithCounts(categories) {
        const categoryFilter = document.getElementById("categoryFilter");
        if (categoryFilter && categories) {
          // è®¡ç®—æ¯ä¸ªåˆ†ç±»çš„äº§å“æ•°é‡
          const categoryCountMap = {};
          allProducts.forEach((product) => {
            categoryCountMap[product.category] =
              (categoryCountMap[product.category] || 0) + 1;
          });

          // æ·»åŠ "å…¨éƒ¨äº§å“"é€‰é¡¹ï¼Œç„¶åæ·»åŠ å…¶ä»–åˆ†ç±»
          const allText =
            window.i18nManager && window.i18nManager.t
              ? window.i18nManager.t("categories.all")
              : "å…¨éƒ¨äº§å“";
          const allOption = `<option value="all" data-i18n="categories.all">${allText} (${allProducts.length})</option>`;
          const categoryOptions = categories
            .filter((category) => category.id !== "all") // é¿å…é‡å¤
            .map((category) => {
              const count = categoryCountMap[category.id] || 0;
              const categoryText =
                window.i18nManager && window.i18nManager.t
                  ? window.i18nManager.t(`categories.${category.id}`)
                  : category.name;
              return `<option value="${category.id}" data-i18n="categories.${category.id}">${categoryText} (${count})</option>`;
            })
            .join("");

          categoryFilter.innerHTML = allOption + categoryOptions;

          // è§¦å‘ç¿»è¯‘å¤„ç†
          if (window.i18nManager) {
            window.i18nManager.processElements(categoryFilter);
          }
          console.log(
            "âœ… åˆ†ç±»ç­›é€‰å™¨å·²æ›´æ–°ï¼ŒåŒ…å«",
            categories.length,
            "ä¸ªåˆ†ç±»ï¼Œå¸¦äº§å“æ•°é‡",
          );
        }
      }

      // æ›´æ–°å“ç‰Œç­›é€‰å™¨é€‰é¡¹
      function updateBrandFilter(brands) {
        const brandFilter = document.getElementById("brandFilter");
        if (brandFilter && brands) {
          // è®¡ç®—æ¯ä¸ªå“ç‰Œçš„äº§å“æ•°é‡
          const brandCountMap = {};
          const unknownBrandText =
            window.i18nManager && window.i18nManager.t
              ? window.i18nManager.t("products.unknown_brand")
              : "æœªçŸ¥å“ç‰Œ";

          allProducts.forEach((product) => {
            const brand = product.brand || unknownBrandText;
            brandCountMap[brand] = (brandCountMap[brand] || 0) + 1;
          });

          // ä»å®é™…äº§å“æ•°æ®ä¸­æå–å“ç‰Œåˆ—è¡¨
          const actualBrands = [
            ...new Set(allProducts.map((p) => p.brand || unknownBrandText)),
          ].sort();

          const allBrandsText =
            window.i18nManager && window.i18nManager.t
              ? window.i18nManager.t("products.all_brands")
              : "å…¨éƒ¨å“ç‰Œ";
          const allOption = `<option value="all" data-i18n="products.all_brands">${allBrandsText}</option>`;
          const brandOptions = actualBrands
            .map((brand) => `<option value="${brand}">${brand}</option>`)
            .join("");

          brandFilter.innerHTML = allOption + brandOptions;

          // è§¦å‘ç¿»è¯‘å¤„ç†
          if (window.i18nManager) {
            window.i18nManager.processElements(brandFilter);
          }
          console.log(
            "âœ… å“ç‰Œç­›é€‰å™¨å·²æ›´æ–°ï¼ŒåŒ…å«",
            actualBrands.length,
            "ä¸ªå“ç‰Œ",
          );
        }
      }

      // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
      document.addEventListener("DOMContentLoaded", async function () {
        console.log("ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–");

        // ç­‰å¾…åˆ†ç±»æ•°æ®åŠ è½½å®Œæˆ
        if (!window.categoryManager || !window.categoryManager.isLoaded) {
          console.log("â³ ç­‰å¾…åˆ†ç±»æ•°æ®åŠ è½½...");
          await window.waitForCategories();
        }

        // åŠ è½½äº§å“æ•°æ®
        await loadProductData();

        // å¿«é€Ÿéšè—åŠ è½½å±å¹•
        setTimeout(() => {
          const loadingScreen = document.getElementById("loading");
          if (loadingScreen) {
            loadingScreen.classList.add("hidden");
            setTimeout(() => {
              loadingScreen.style.display = "none";
            }, 300);
          }

          // æ£€æŸ¥æœç´¢å‚æ•°
          const searchParam = getUrlParameter("search");
          if (searchParam) {
            const searchInput = document.getElementById("searchInput");
            if (searchInput) {
              searchInput.value = searchParam;
              searchProducts(searchParam);
            }
          }
        }, 200);
      });

      // ä»APIåŠ è½½äº§å“æ•°æ®
      async function loadProductData() {
        console.log("ğŸ“¦ å¼€å§‹åŠ è½½äº§å“æ•°æ®");

        try {
          // æ£€æŸ¥æ˜¯å¦å·²ç»åŠ è½½è¿‡æ•°æ®
          if (allProducts.length > 0) {
            console.log("â­ï¸ äº§å“æ•°æ®å·²å­˜åœ¨ï¼Œè·³è¿‡åŠ è½½");
            return;
          }

          const response = await fetch("/api/public/products?limit=1000"); // ğŸŒ ä½¿ç”¨å…¬å¼€APIæ¥å£è·å–äº§å“æ•°æ®
          if (!response.ok) {
            throw new Error("äº§å“æ•°æ®åŠ è½½å¤±è´¥");
          }

          const data = await response.json();
          // ä»åˆ†é¡µå“åº”ä¸­æå–äº§å“æ•°ç»„ï¼Œå‘åå…¼å®¹ç›´æ¥æ•°ç»„æ ¼å¼
          const products = data.data || data.products || data || [];
          console.log("âœ… æˆåŠŸè·å–äº§å“æ•°æ®:", products.length, "ä¸ªäº§å“");

          // æ›´æ–°å…¨å±€äº§å“æ•°æ®
          allProducts = products;
          currentProducts = [...allProducts];

          // æ¸²æŸ“äº§å“åˆ—è¡¨
          renderProducts(currentProducts);

          // å¦‚æœåˆ†ç±»æ•°æ®å·²åŠ è½½ï¼Œæ›´æ–°ç­›é€‰å™¨ï¼ˆç°åœ¨æœ‰äº§å“æ•°æ®äº†ï¼‰
          if (window.categoryManager && window.categoryManager.isLoaded) {
            console.log("ğŸ”„ äº§å“æ•°æ®åŠ è½½å®Œæˆï¼Œæ›´æ–°ç­›é€‰å™¨");
            updateFiltersWithProductData(
              window.categoryManager.categories,
              window.categoryManager.brands,
            );
          }

          // æ£€æŸ¥å¹¶åº”ç”¨URLå‚æ•°ç­›é€‰
          checkAndApplyUrlFilters();
        } catch (error) {
          console.error("âŒ åŠ è½½äº§å“æ•°æ®æ—¶å‡ºé”™:", error);
          // æ˜¾ç¤ºé”™è¯¯æç¤º
          const grid = document.querySelector(".products-grid");
          if (grid) {
            grid.innerHTML = `
                        <div class="error-message">
                            <i class="fas fa-exclamation-circle"></i>
                            <p>åŠ è½½äº§å“æ•°æ®æ—¶å‡ºé”™ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</p>
                        </div>
                    `;
          }
        }
      }

      // æ³¨æ„ï¼šgetProductFeatures å‡½æ•°å·²è¿ç§»åˆ° product-card-component.js ç»Ÿä¸€ç®¡ç†

      // æ³¨æ„ï¼šäº§å“å¡ç‰‡ç›¸å…³å‡½æ•°å·²è¿ç§»åˆ° product-card-component.js ç»Ÿä¸€ç®¡ç†

      // æ£€æŸ¥URLå‚æ•°å¹¶åº”ç”¨ç­›é€‰
      function checkAndApplyUrlFilters() {
        const urlParams = new URLSearchParams(window.location.search);
        const categoryParam = urlParams.get("category");
        const searchParam = urlParams.get("search");

        console.log(
          "ğŸ¯ æ£€æŸ¥URLå‚æ•° - åˆ†ç±»:",
          categoryParam,
          "æœç´¢:",
          searchParam,
        );

        // å¤„ç†åˆ†ç±»å‚æ•°
        if (categoryParam) {
          console.log("ğŸ” åº”ç”¨åˆ†ç±»ç­›é€‰:", categoryParam);
          filterByCategory(categoryParam);

          // æ›´æ–°ä¸‹æ‹‰æ¡†é€‰æ‹©
          const categoryFilter = document.getElementById("categoryFilter");
          if (categoryFilter) {
            // ä½¿ç”¨ç¿»è¯‘ç³»ç»Ÿæ˜ å°„URLå‚æ•°åˆ°ä¸‹æ‹‰æ¡†é€‰é¡¹
            const getCategoryDisplayName = (category) => {
              const categoryKey = `categories.${category}`;
              const i18n = window.i18nManager || window.i18n;

              if (i18n && i18n.t) {
                const translatedName = i18n.t(categoryKey);
                if (translatedName && translatedName !== categoryKey) {
                  return translatedName;
                }
              }

              // å›é€€åˆ°ç¡¬ç¼–ç æ˜ å°„ï¼ˆå…¼å®¹æ€§ä¿è¯ï¼‰
              const categoryMap = {
                turbocharger: "æ¶¡è½®å¢å‹å™¨",
                actuator: "æ‰§è¡Œå™¨",
                injector: "å…±è½¨å–·æ²¹å™¨",
                "turbo-parts": "æ¶¡è½®é…ä»¶",
                others: "å…¶ä»–",
              };
              return categoryMap[category] || category;
            };

            const displayName = getCategoryDisplayName(categoryParam);
            if (displayName) {
              // æŸ¥æ‰¾å¯¹åº”çš„é€‰é¡¹
              for (let option of categoryFilter.options) {
                if (option.text.includes(displayName)) {
                  categoryFilter.value = option.value;
                  console.log("âœ… æ›´æ–°ä¸‹æ‹‰æ¡†é€‰æ‹©:", option.text);
                  break;
                }
              }
            }
          }
        }

        // å¤„ç†æœç´¢å‚æ•°
        if (searchParam) {
          console.log("ğŸ” åº”ç”¨æœç´¢ç­›é€‰:", searchParam);
          const searchInput = document.getElementById("searchInput");
          if (searchInput) {
            searchInput.value = searchParam;
            searchProducts(searchParam);
          }
        }
      }

      // å¤‡ç”¨äº§å“æ•°æ®
      function loadFallbackData() {
        allProducts = [
          {
            id: "GT1749V",
            name: "GT1749V æ¶¡è½®å¢å‹å™¨æ€»æˆ",
            brand: "Garrett",
            category: "turbocharger", // âœ… æ­£ç¡®çš„åˆ†ç±»ID
            model: "GT1749V-724930",
            description: "é€‚ç”¨äºå¤§ä¼—ã€å¥¥è¿ª1.9L TDIå‘åŠ¨æœºï¼ŒåŸå‚å“è´¨ï¼Œæ€§èƒ½ç¨³å®š",
            features: ["åŸå‚å“è´¨", "æ€§èƒ½ç¨³å®š", "è´¨ä¿1å¹´"],
            badge: "hot",
            image: "../assets/images/carousel/img1.jpg",
          },
          {
            id: "0445120123",
            name: "0445120123 å…±è½¨å–·æ²¹å™¨",
            brand: "Bosch",
            category: "injector", // ğŸ”§ ä¿®å¤ï¼šä» "diesel-injection" æ”¹ä¸º "injector"
            model: "0445120123",
            description: "BoschåŸå‚å…±è½¨å–·æ²¹å™¨ï¼Œé€‚ç”¨äºå¤šç§æŸ´æ²¹å‘åŠ¨æœº",
            features: ["åŸå‚æ­£å“", "é«˜ç²¾åº¦", "é•¿å¯¿å‘½"],
            badge: "new",
            image: "../assets/images/carousel/img2.jpg",
          },
          {
            id: "ACT001",
            name: "VGT 3798462 ç”µå­æ‰§è¡Œå™¨",
            brand: "Diamond-Auto",
            category: "actuator", // âœ… æ·»åŠ æ‰§è¡Œå™¨äº§å“
            model: "3798462",
            description: "é€‚ç”¨äºæ²ƒå°”æ²ƒFL220ã€é“å¥‡Ramï¼Œç”µå­å¯å˜å‡ ä½•æ¶¡è½®æ‰§è¡Œå™¨",
            features: ["ç”µå­æ§åˆ¶", "ç²¾å‡†è°ƒèŠ‚", "åŸå‚å“è´¨"],
            badge: "tech",
            image: "../assets/images/carousel/img1.jpg",
          },
          {
            id: "PARTS001",
            name: "æ¶¡è½®å¢å‹å™¨ç»´ä¿®å¥—ä»¶",
            brand: "Diamond-Auto",
            category: "turbo-parts", // âœ… æ·»åŠ æ¶¡è½®é…ä»¶äº§å“
            model: "KIT-GT1749V",
            description: "GT1749Væ¶¡è½®å¢å‹å™¨ä¸“ç”¨ç»´ä¿®å¥—ä»¶ï¼ŒåŒ…å«å¯†å°ä»¶ã€è½´æ‰¿ç­‰",
            features: ["é…ä»¶é½å…¨", "ä¸“ä¸šå·¥å…·", "è´¨ä¿1å¹´"],
            badge: "parts",
            image: "../assets/images/carousel/img2.jpg",
          },
          {
            id: "OTHER001",
            name: "ä¸“ä¸šè¯Šæ–­å·¥å…·",
            brand: "Diamond-Auto",
            category: "others", // âœ… æ·»åŠ å…¶ä»–ç±»åˆ«äº§å“
            model: "DIAG-PRO",
            description: "æ¶¡è½®å¢å‹å™¨å’Œå…±è½¨ç³»ç»Ÿä¸“ä¸šè¯Šæ–­å·¥å…·",
            features: ["ä¸“ä¸šè¯Šæ–­", "å¤šç³»ç»Ÿæ”¯æŒ", "ä¾¿æºè®¾è®¡"],
            badge: "pro",
            image: "../assets/images/carousel/img1.jpg",
          },
        ];
        currentProducts = [...allProducts];
        renderProducts(currentProducts);
      }

      // æ›´æ–°äº§å“è®¡æ•°æ˜¾ç¤º
      function updateProductCount(count) {
        console.log("ğŸ“Š æ›´æ–°äº§å“è®¡æ•°:", count);

        // æ›´æ–°æœç´¢æ¡†åé¢çš„äº§å“è®¡æ•°æ˜¾ç¤º
        const searchResultsCount =
          document.getElementById("searchResultsCount");
        if (searchResultsCount && count !== undefined) {
          const countText = searchResultsCount.querySelector(".count-text");
          if (countText) {
            // ä½¿ç”¨ç¿»è¯‘ç³»ç»Ÿæ›´æ–°äº§å“è®¡æ•°
            if (window.i18nManager && window.i18nManager.t) {
              countText.textContent = window.i18nManager.t(
                "products.total_products",
                { count: count },
              );
            } else {
              countText.textContent = `å…±${count}ä¸ªäº§å“`;
            }
            // æ›´æ–°data-i18n-paramså±æ€§ä»¥ä¾¿åç»­è¯­è¨€åˆ‡æ¢
            countText.setAttribute(
              "data-i18n-params",
              JSON.stringify({ count: count }),
            );
          }
        }

        // æ˜¾ç¤º/éšè—æ— ç»“æœæç¤º
        const noResults = document.getElementById("noResults");
        const productsGrid = document.getElementById("productsGrid");

        if (count === 0) {
          if (noResults) noResults.style.display = "block";
          if (productsGrid) productsGrid.style.display = "none";
        } else {
          if (noResults) noResults.style.display = "none";
          if (productsGrid) productsGrid.style.display = "grid";
        }
      }

      // æ¸²æŸ“äº§å“åˆ—è¡¨
      function renderProducts(products) {
        if (isRendering) {
          console.log("ğŸš« æ¸²æŸ“æ­£åœ¨è¿›è¡Œä¸­ï¼Œè·³è¿‡é‡å¤æ¸²æŸ“");
          return;
        }

        isRendering = true;
        console.log("ğŸ¨ å¼€å§‹æ¸²æŸ“äº§å“åˆ—è¡¨:", products.length, "ä¸ªäº§å“");

        // ä¿å­˜å½“å‰æ˜¾ç¤ºçš„äº§å“åˆ—è¡¨ï¼Œä¾›è¯­è¨€åˆ‡æ¢æ—¶é‡æ–°æ¸²æŸ“ä½¿ç”¨
        window.currentDisplayProducts = products;

        try {
          // ç¡®ä¿äº§å“å¡ç»„ä»¶å·²åŠ è½½
          if (!window.productCardComponent) {
            console.error("âŒ äº§å“å¡ç»„ä»¶æœªåŠ è½½ï¼Œå°è¯•åˆå§‹åŒ–...");
            window.productCardComponent = new ProductCardComponent();
          }

          // ä½¿ç”¨ç»Ÿä¸€çš„äº§å“å¡ç»„ä»¶æ¸²æŸ“
          window.productCardComponent.renderToGrid(products, {
            showDescription: false,
            imagePath: "../",
          });

          // æ›´æ–°äº§å“è®¡æ•°
          updateProductCount(products.length);
        } catch (error) {
          console.error("âŒ æ¸²æŸ“äº§å“åˆ—è¡¨æ—¶å‡ºé”™:", error);

          // å¦‚æœç»„ä»¶æ¸²æŸ“å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ¸²æŸ“æ–¹å¼
          const grid = document.querySelector(".products-grid");
          if (grid) {
            grid.innerHTML = `
                        <div class="error-message">
                            <i class="fas fa-exclamation-circle"></i>
                            <p>äº§å“æ¸²æŸ“å‡ºé”™: ${error.message}</p>
                            <p>è¯·åˆ·æ–°é¡µé¢é‡è¯•</p>
                        </div>
                    `;
          }
        } finally {
          isRendering = false;
          console.log("âœ… äº§å“åˆ—è¡¨æ¸²æŸ“å®Œæˆ");
        }
      }

      // æŒ‰åˆ†ç±»ç­›é€‰ - å¢å¼ºç‰ˆæœ¬ï¼Œæ”¯æŒå¤šç§åˆ†ç±»å­—æ®µæ ¼å¼
      function filterByCategory(category) {
        console.log('ğŸ” å¼€å§‹åˆ†ç±»ç­›é€‰:', category);
        console.log('ğŸ“¦ å½“å‰æ‰€æœ‰äº§å“æ•°é‡:', allProducts.length);

        // æ‰“å°æ‰€æœ‰äº§å“çš„åˆ†ç±»ä¿¡æ¯ç”¨äºè°ƒè¯•
        console.log('ğŸ“‹ æ‰€æœ‰äº§å“åˆ†ç±»ä¿¡æ¯:', allProducts.map(p => ({
          id: p.id,
          name: p.name,
          category: p.category,
          categorySlug: p.categorySlug,
          categoryName: p.categoryName,
          categoryInfo: p.categoryInfo
        })));

        if (category === "all") {
          currentProducts = [...allProducts];
          console.log('âœ… æ˜¾ç¤ºå…¨éƒ¨äº§å“:', currentProducts.length, 'ä¸ª');
        } else {
          // å¢å¼ºçš„åˆ†ç±»ç­›é€‰é€»è¾‘ï¼Œæ”¯æŒå¤šç§åˆ†ç±»å­—æ®µæ ¼å¼
          currentProducts = allProducts.filter((product) => {
            // è·å–äº§å“çš„åˆ†ç±»ä¿¡æ¯ï¼Œæ”¯æŒå¤šç§æ ¼å¼
            let productCategory = '';

            if (typeof product.category === 'string') {
              // ç›´æ¥çš„åˆ†ç±»å­—ç¬¦ä¸²
              productCategory = product.category;
            } else if (typeof product.category === 'object' && product.category) {
              // åˆ†ç±»å¯¹è±¡ï¼Œéœ€è¦æ˜ å°„åˆ°å¯¹åº”çš„slug
              const categoryName = product.category.name;
              // æ ¹æ®åˆ†ç±»åç§°æ˜ å°„åˆ°å¯¹åº”çš„slug
              const categoryMapping = {
                'æ¶¡è½®å¢å‹å™¨': 'turbocharger',
                'æ‰§è¡Œå™¨': 'actuator',
                'å…±è½¨å–·æ²¹å™¨': 'injector',
                'æ¶¡è½®é…ä»¶': 'turbo-parts',
                'å…¶ä»–': 'others'
              };
              productCategory = categoryMapping[categoryName] || '';
            } else {
              // å…¶ä»–æ ¼å¼çš„åˆ†ç±»å­—æ®µ
              productCategory =
                product.categorySlug || // åˆ†ç±»slug
                product.categoryName || // åˆ†ç±»åç§°
                (product.categoryInfo && product.categoryInfo.id) || // åˆ†ç±»å¯¹è±¡çš„ID
                (product.categoryInfo && product.categoryInfo.slug) || // åˆ†ç±»å¯¹è±¡çš„slug
                '';
            }

            // åˆ†ç±»åŒ¹é…é€»è¾‘
            const isMatch = productCategory === category;

            if (isMatch) {
              console.log('âœ… åŒ¹é…äº§å“:', product.name, 'åˆ†ç±»:', productCategory, '(æ¥æº:', typeof product.category === 'object' ? product.category.name : product.category, ')');
            }

            return isMatch;
          });

          console.log('ğŸ¯ ç­›é€‰ç»“æœ:', currentProducts.length, 'ä¸ªäº§å“åŒ¹é…åˆ†ç±»', category);

          // å¦‚æœæ²¡æœ‰åŒ¹é…çš„äº§å“ï¼Œæ‰“å°è¯¦ç»†ä¿¡æ¯å¸®åŠ©è°ƒè¯•
          if (currentProducts.length === 0) {
            console.warn('âš ï¸ æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„äº§å“ï¼');
            console.log('ğŸ” æœŸæœ›çš„åˆ†ç±»ID:', category);
            console.log('ğŸ“‹ å®é™…çš„äº§å“åˆ†ç±»:', allProducts.map(p => p.category).filter(Boolean));

            // æ£€æŸ¥æ˜¯å¦æœ‰ç›¸ä¼¼çš„åˆ†ç±»
            const similarCategories = allProducts
              .map(p => p.category)
              .filter(Boolean)
              .filter(cat => {
                // ç¡®ä¿catæ˜¯å­—ç¬¦ä¸²
                const catStr = typeof cat === 'string' ? cat : String(cat);
                return catStr.toLowerCase().includes(category.toLowerCase()) ||
                       category.toLowerCase().includes(catStr.toLowerCase());
              });

            if (similarCategories.length > 0) {
              console.log('ğŸ’¡ å‘ç°ç›¸ä¼¼åˆ†ç±»:', similarCategories);
            }
          }
        }

        renderProducts(currentProducts);

        // æ›´æ–°æ ‡ç­¾æ çŠ¶æ€
        document.querySelectorAll(".tag-btn").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.dataset.category === category) {
            btn.classList.add("active");
          }
        });

        // æ›´æ–°ä¸‹æ‹‰æ¡†çŠ¶æ€
        const categoryFilter = document.getElementById("categoryFilter");
        if (categoryFilter) {
          categoryFilter.value = category;
        }

        console.log('ğŸ åˆ†ç±»ç­›é€‰å®Œæˆ');
      }

      // æŒ‰å“ç‰Œç­›é€‰
      function filterByBrand(brand) {
        if (brand === "all") {
          currentProducts = [...allProducts];
        } else {
          currentProducts = allProducts.filter(
            (product) => product.brand === brand,
          );
        }
        renderProducts(currentProducts);
      }

      // æœç´¢äº§å“ - æ‰©å±•æœç´¢èŒƒå›´åŒ…å«OEå·ç å’Œé€‚é…ä¿¡æ¯
      function searchProducts(searchTerm) {
        if (!searchTerm || !searchTerm.trim()) {
          currentProducts = [...allProducts];
        } else {
          const term = searchTerm.toLowerCase().trim();
          currentProducts = allProducts.filter((product) => {
            const nameMatch =
              product.name && product.name.toLowerCase().includes(term);
            const brandMatch =
              product.brand && product.brand.toLowerCase().includes(term);
            const modelMatch =
              product.model && product.model.toLowerCase().includes(term);
            const descMatch =
              product.description &&
              product.description.toLowerCase().includes(term);
            const skuMatch =
              product.sku && product.sku.toLowerCase().includes(term);
            const oeMatch =
              product.oe_number &&
              product.oe_number.toLowerCase().includes(term);
            const compatibilityMatch =
              product.compatibility &&
              product.compatibility.toLowerCase().includes(term);
            const notesMatch =
              product.notes && product.notes.toLowerCase().includes(term);
            const featuresMatch =
              product.features && product.features.toLowerCase().includes(term);

            return (
              nameMatch ||
              brandMatch ||
              modelMatch ||
              descMatch ||
              skuMatch ||
              oeMatch ||
              compatibilityMatch ||
              notesMatch ||
              featuresMatch
            );
          });
        }

        renderProducts(currentProducts);
      }

      // äº§å“ç­›é€‰ï¼ˆå…¼å®¹ä¸»é¡µè°ƒç”¨ï¼‰
      function filterProducts(category) {
        filterByCategory(category);
      }

      // æ ‡ç­¾æ ç­›é€‰äº§å“
      function filterProductsByTag(category) {
        // æ›´æ–°ä¸‹æ‹‰æ¡†é€‰æ‹©
        const categoryFilter = document.getElementById("categoryFilter");
        if (categoryFilter) {
          categoryFilter.value = category;
        }

        // æ‰§è¡Œç­›é€‰
        filterByCategory(category);

        // æ›´æ–°æ ‡ç­¾æŒ‰é’®çŠ¶æ€
        document.querySelectorAll(".tag-btn").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.dataset.category === category) {
            btn.classList.add("active");
          }
        });
      }

      // å¯¼èˆªæ æœç´¢åŠŸèƒ½
      function performSearch() {
        const searchInput = document.getElementById("searchInput");
        const searchTerm = searchInput.value.toLowerCase().trim();

        if (!searchTerm) {
          return;
        }

        searchProducts(searchTerm);
      }

      // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
      function toggleMobileMenu() {
        const navMenu = document.querySelector(".nav-menu");
        const mobileMenuBtn = document.querySelector(".mobile-menu-btn");

        if (navMenu && mobileMenuBtn) {
          navMenu.classList.toggle("active");
          mobileMenuBtn.classList.toggle("active");
        }
      }

      // æœç´¢æ¡†å›è½¦äº‹ä»¶
      document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("searchInput");
        if (searchInput) {
          searchInput.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              performSearch();
            }
          });
        }

        const productSearch = document.getElementById("productSearch");
        if (productSearch) {
          productSearch.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              searchProducts(this.value);
            }
          });
        }
      });

      // åˆå§‹åŒ–é¡µé¢ç‰¹å®šåŠŸèƒ½ï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼Œç­‰å¾…ç»„ä»¶æ¸²æŸ“å®Œæˆï¼‰
      function initPageSpecificFeatures() {
        // è¿”å›é¡¶éƒ¨åŠŸèƒ½
        const backToTopBtn = document.getElementById("backToTop");
        if (backToTopBtn) {
          window.addEventListener("scroll", function () {
            if (window.pageYOffset > 300) {
              backToTopBtn.classList.add("visible");
            } else {
              backToTopBtn.classList.remove("visible");
            }
          });

          backToTopBtn.addEventListener("click", function () {
            window.scrollTo({
              top: 0,
              behavior: "smooth",
            });
          });
          console.log("âœ… è¿”å›é¡¶éƒ¨æŒ‰é’®å·²åˆå§‹åŒ–");
        } else {
          console.warn("âš ï¸ æœªæ‰¾åˆ°è¿”å›é¡¶éƒ¨æŒ‰é’®ï¼Œå°†åœ¨1ç§’åé‡è¯•");
          setTimeout(initPageSpecificFeatures, 1000);
          return;
        }

        // é¡µç è·³è½¬åŠŸèƒ½
        const pageNumberInput = document.getElementById("pageNumber");
        if (pageNumberInput) {
          pageNumberInput.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              jumpToPage();
            }
          });
          console.log("âœ… é¡µç è·³è½¬åŠŸèƒ½å·²åˆå§‹åŒ–");
        }
      }

      // å…¨å±€è·³è½¬å‡½æ•°
      window.jumpToPage = function () {
        if (window.productCardComponent) {
          window.productCardComponent.jumpToPage();
        } else {
          console.error("âŒ äº§å“å¡ç»„ä»¶æœªåŠ è½½");
        }
      };

      // ğŸŒ ç›‘å¬è¯­è¨€åˆ‡æ¢äº‹ä»¶ï¼Œé‡æ–°æ¸²æŸ“äº§å“å¡ç‰‡
      document.addEventListener("i18n:changed", function (event) {
        console.log("ğŸŒ äº§å“é¡µé¢ç›‘å¬åˆ°è¯­è¨€åˆ‡æ¢äº‹ä»¶:", event.detail);

        // é‡æ–°æ¸²æŸ“å½“å‰æ˜¾ç¤ºçš„äº§å“
        if (
          window.currentDisplayProducts &&
          window.currentDisplayProducts.length > 0
        ) {
          console.log("ğŸ·ï¸ é‡æ–°æ¸²æŸ“äº§å“å¡ç‰‡ä»¥æ›´æ–°ç‰¹æ€§æ ‡ç­¾ç¿»è¯‘...");
          setTimeout(() => {
            renderProducts(window.currentDisplayProducts);
            console.log("âœ… äº§å“å¡ç‰‡ç¿»è¯‘å·²æ›´æ–°");
          }, 200);
        }
      });

      // ç­‰å¾…ç»„ä»¶æ¸²æŸ“å®Œæˆååˆå§‹åŒ–åŠŸèƒ½
      setTimeout(initPageSpecificFeatures, 500);
    </script>

    <!-- ğŸ”§ æ—©æœŸè¯­è¨€æ£€æµ‹è„šæœ¬ - åœ¨æ‰€æœ‰å…¶ä»–è„šæœ¬ä¹‹å‰æ‰§è¡Œï¼Œé¿å…è¯­è¨€é—ªçƒ -->
    <script>
      (function () {
        "use strict";
        console.log("ğŸŒ æ—©æœŸè¯­è¨€æ£€æµ‹å¼€å§‹...");

        // æ£€æµ‹ç”¨æˆ·åå¥½è¯­è¨€
        const preferredLang =
          localStorage.getItem("preferred-language") ||
          navigator.language ||
          navigator.userLanguage ||
          "zh-CN";

        console.log("ğŸŒ æ£€æµ‹åˆ°ç”¨æˆ·åå¥½è¯­è¨€:", preferredLang);

        // ç«‹å³è®¾ç½®HTML langå±æ€§ï¼Œé¿å…é—ªçƒ
        const langCode = preferredLang.split("-")[0];
        document.documentElement.lang = langCode;

        // åœ¨windowå¯¹è±¡ä¸Šè®¾ç½®æ—©æœŸè¯­è¨€ä¿¡æ¯ï¼Œä¾›åç»­è„šæœ¬ä½¿ç”¨
        window.earlyLanguageDetection = {
          preferredLanguage: preferredLang,
          langCode: langCode,
          timestamp: Date.now(),
        };

        console.log("âœ… æ—©æœŸè¯­è¨€æ£€æµ‹å®Œæˆï¼ŒHTML langå·²è®¾ç½®ä¸º:", langCode);
      })();
    </script>

    <!-- ğŸš€ ç»Ÿä¸€é¡µé¢åŠ è½½ç®¡ç†å™¨ - å¿…é¡»æœ€å…ˆåŠ è½½ -->
    <script src="../assets/js/page-load-manager.js"></script>

    <!-- ğŸ¨ WebPå›¾ç‰‡ä¼˜åŒ–åŠ è½½å™¨ -->
    <script src="../assets/js/webp-loader.js"></script>

    <!-- ğŸŒ å›½é™…åŒ–ç®¡ç†å™¨ -->
    <script src="../assets/js/i18n-manager.js"></script>

    <!-- ğŸ” SEOç»“æ„åŒ–æ•°æ®ç®¡ç†å™¨ -->
    <script src="../assets/js/seo-structured-data.js"></script>

    <!-- ğŸ”§ é¡µå¤´æœç´¢åŠŸèƒ½ä¿®å¤æ¨¡å— -->
    <script src="../assets/js/search-fix.js"></script>

    <!-- ğŸ”§ äº§å“é¡µé¢æœç´¢åŠŸèƒ½ä¿®å¤æ¨¡å— -->
    <script src="../assets/js/product-search-fix.js"></script>

    <!-- ä¸»è¦JavaScriptæ–‡ä»¶ -->
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/resource-checker.js"></script>
  </body>
</html>
